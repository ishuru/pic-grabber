(()=>{var t={213:t=>{class e{constructor(){this.metrics={screenshotCount:0,imageCount:0,avgResponseTime:0,uptime:0},this.isEnabled=!0,this.autoCapture=!1,this.behaviorTracking=!0,this.initializeElements(),this.setupEventListeners(),this.loadState(),this.startMetricsUpdate()}initializeElements(){this.captureBtn=document.getElementById("captureBtn"),this.openSidebarBtn=document.getElementById("openSidebarBtn"),this.scanBtn=document.getElementById("scanBtn"),this.autoCaptureToggle=document.getElementById("autoCaptureToggle"),this.trackingToggle=document.getElementById("trackingToggle"),this.statusDot=document.getElementById("statusDot"),this.statusText=document.getElementById("statusText"),this.screenshotCount=document.getElementById("screenshotCount"),this.imageCount=document.getElementById("imageCount"),this.avgResponseTime=document.getElementById("avgResponseTime"),this.uptime=document.getElementById("uptime"),this.loadingIndicator=document.getElementById("loadingIndicator")}setupEventListeners(){this.captureBtn.addEventListener("click",()=>{this.captureScreenshot()}),this.openSidebarBtn.addEventListener("click",()=>{this.openSidebar()}),this.scanBtn.addEventListener("click",()=>{this.scanImages()}),this.autoCaptureToggle.addEventListener("change",t=>{this.autoCapture=t.target.checked,this.saveState(),this.updateStatus()}),this.trackingToggle.addEventListener("change",t=>{this.behaviorTracking=t.target.checked,this.saveState(),this.updateStatus()})}async loadState(){try{const t=await chrome.storage.local.get(["enabled","autoCapture","behaviorTracking","screenshotCount","imageCount"]);this.isEnabled=!1!==t.enabled,this.autoCapture=t.autoCapture||!1,this.behaviorTracking=!1!==t.behaviorTracking,this.metrics.screenshotCount=t.screenshotCount||0,this.metrics.imageCount=t.imageCount||0,this.updateUI(),this.updateStatus()}catch(t){console.error("[Kai] Error loading state:",t)}}async saveState(){try{await chrome.storage.local.set({enabled:this.isEnabled,autoCapture:this.autoCapture,behaviorTracking:this.behaviorTracking,screenshotCount:this.metrics.screenshotCount,imageCount:this.metrics.imageCount})}catch(t){console.error("[Kai] Error saving state:",t)}}async captureScreenshot(){try{this.showLoading(!0),this.captureBtn.disabled=!0;const t=performance.now(),[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e)throw new Error("No active tab found");const s=await chrome.tabs.sendMessage(e.id,{type:"captureScreenshot"});if(!s||!s.success)throw new Error("Screenshot capture failed");{const e=performance.now()-t;this.metrics.screenshotCount++,this.metrics.avgResponseTime=(this.metrics.avgResponseTime+e)/2,this.updateMetrics(),this.saveState(),this.showSuccessFeedback("Screenshot captured successfully!"),console.log(`[Kai] Screenshot captured in ${e.toFixed(2)}ms`)}}catch(t){console.error("[Kai] Screenshot capture error:",t),this.showErrorFeedback("Screenshot capture failed")}finally{this.showLoading(!1),this.captureBtn.disabled=!1}}async openSidebar(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t&&(await chrome.sidePanel.open({tabId:t.id}),window.close())}catch(t){console.error("[Kai] Error opening sidebar:",t),this.showErrorFeedback("Failed to open sidebar")}}async scanImages(){try{this.showLoading(!0),this.scanBtn.disabled=!0;const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t&&(await chrome.tabs.sendMessage(t.id,{type:"scanImagesForSidebar"}),setTimeout(()=>{this.updateMetrics()},1e3),this.showSuccessFeedback("Image scan completed"))}catch(t){console.error("[Kai] Error scanning images:",t),this.showErrorFeedback("Image scan failed")}finally{this.showLoading(!1),this.scanBtn.disabled=!1}}async updateMetrics(){try{const t=await chrome.runtime.sendMessage({type:"getMetrics"});t&&t.metrics&&(this.metrics.screenshotCount=t.metrics.screenshot.count,this.metrics.avgResponseTime=t.metrics.screenshot.avgTime,this.metrics.uptime=t.uptime||0,this.updateMetricsDisplay())}catch(t){console.error("[Kai] Error updating metrics:",t)}}updateMetricsDisplay(){this.screenshotCount.textContent=this.metrics.screenshotCount,this.imageCount.textContent=this.metrics.imageCount,this.avgResponseTime.textContent=`${this.metrics.avgResponseTime.toFixed(0)}ms`;const t=Math.floor(this.metrics.uptime/1e3),e=Math.floor(t/60),s=t%60;this.uptime.textContent=`${e}m ${s}s`}updateUI(){this.autoCaptureToggle.checked=this.autoCapture,this.trackingToggle.checked=this.behaviorTracking,this.updateMetricsDisplay()}updateStatus(){this.isEnabled&&this.behaviorTracking?(this.statusDot.classList.remove("inactive"),this.statusText.textContent="System Active"):this.isEnabled?(this.statusDot.classList.remove("inactive"),this.statusText.textContent="Basic Mode"):(this.statusDot.classList.add("inactive"),this.statusText.textContent="System Disabled")}showLoading(t){this.loadingIndicator.style.display=t?"block":"none"}showSuccessFeedback(t){const e=document.createElement("div");e.textContent=t,e.style.cssText="\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: #4ade80;\n            color: white;\n            padding: 8px 16px;\n            border-radius: 6px;\n            font-size: 12px;\n            z-index: 1000;\n            animation: fadeInOut 3s ease-in-out;\n        ",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}showErrorFeedback(t){const e=document.createElement("div");e.textContent=t,e.style.cssText="\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: #f87171;\n            color: white;\n            padding: 8px 16px;\n            border-radius: 6px;\n            font-size: 12px;\n            z-index: 1000;\n            animation: fadeInOut 3s ease-in-out;\n        ",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}startMetricsUpdate(){setInterval(()=>{this.updateMetrics()},5e3),this.updateMetrics()}}const s=document.createElement("style");s.textContent="\n    @keyframes fadeInOut {\n        0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }\n        20% { opacity: 1; transform: translateX(-50%) translateY(0); }\n        80% { opacity: 1; transform: translateX(-50%) translateY(0); }\n        100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }\n    }\n",document.head.appendChild(s),document.addEventListener("DOMContentLoaded",()=>{new e,t.exports&&(t.exports=e)})}},e={};!function s(a){var n=e[a];if(void 0!==n)return n.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,s),i.exports}(213)})();